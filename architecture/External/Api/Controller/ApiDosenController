<?php

namespace Architecture\External\Api\Controller;

use App\Http\Controllers\Controller;
use Architecture\Application\Abstractions\Messaging\ICommandBus;
use Architecture\Application\Abstractions\Messaging\IQueryBus;
use Architecture\Application\Dosen\GetInfoDosenQuery;
use Exception;

class ApiDosenController extends Controller
{
    public function __construct(
        protected ICommandBus $commandBus,
        protected IQueryBus $queryBus
    ) {}
    
    public function InfoDosen($nidn){
        try {
            $dosen = $this->queryBus->ask(
                new GetInfoDosenQuery($nidn)
            );

            return response()->json([
                "status"=>"ok",
                "message"=>"",
                "data"=>(object)[
                    "nidn"=>$dosen->GetNidn(),
                    "nama"=>$dosen->GetNama(),
                    "fakultas"=>$dosen->GetFakultas(),
                    "prodi"=>$dosen->GetProdi(),
                ],
            ]);
        } catch (Exception $e) {
            return response()->json([
                "status"=>"fail",
                "message"=>"dosen tidak ditemukan",
                "data"=>null,
                ""=>$e->getMessage()
            ]);
        }
    }
}
